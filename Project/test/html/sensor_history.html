<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>전체 센서 기록 - 스마트팜 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
    </style>
</head>
<body class="bg-slate-100">

<div class="flex h-screen">
    <div th:replace="~{fragments/sidebar :: sidebarFragment(active='sensor-history')}"></div>

    <main class="flex-1 p-8 overflow-y-auto">
        <h2 class="text-3xl font-bold text-slate-800 mb-6">전체 센서 기록</h2>

        <div class="bg-white p-6 rounded-xl shadow-md border border-slate-200 mb-8">
            <form th:action="@{/sensor_history}" method="get">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-end">
                    <div>
                        <label for="startDate" class="block text-sm font-medium text-gray-700">시작일</label>
                        <input type="datetime-local" id="startDate" name="startDate" th:value="${param.startDate}"
                               class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="endDate" class="block text-sm font-medium text-gray-700">종료일</label>
                        <input type="datetime-local" id="endDate" name="endDate" th:value="${param.endDate}"
                               class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <div>
                        <label for="deviceId" class="block text-sm font-medium text-gray-700">장치 ID</label>
                        <input type="text" id="deviceId" name="deviceId" placeholder="raspi-01" th:value="${param.deviceId}"
                               class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <div class="flex justify-end gap-4 mt-6 pt-4 border-t">
                    <a th:href="@{/sensor_history}" class="px-6 py-2 bg-gray-600 text-white font-semibold rounded-md hover:bg-gray-700 transition-colors">초기화</a>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors">검색</button>
                </div>
            </form>
        </div>
        <div class="bg-white rounded-xl shadow-md border border-slate-200 overflow-x-auto">
            <div class="p-6">
                <h3 class="text-xl font-semibold text-slate-700">전체 센서 기록</h3>
            </div>
            <table class="w-full text-sm text-left text-slate-500">
                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                <tr>
                    <th scope="col" class="px-6 py-3">ID</th>
                    <th scope="col" class="px-6 py-3">장치 ID</th>
                    <th scope="col" class="px-6 py-3">온도 (°C)</th>
                    <th scope="col" class="px-6 py-3">습도 (%)</th>
                    <th scope="col" class="px-6 py-3">토양습도 (%)</th>
                    <th scope="col" class="px-6 py-3">물 수위</th>
                    <th scope="col" class="px-6 py-3">시간</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="data : ${sensorDataList}" class="bg-white border-b hover:bg-slate-50">
                    <td class="px-6 py-4" th:text="${data.id}"></td>
                    <td class="px-6 py-4 font-medium text-slate-900" th:text="${data.raspberryId}"></td>
                    <td class="px-6 py-4" th:text="${data.temperature}"></td>
                    <td class="px-6 py-4" th:text="${data.humidity}"></td>
                    <td class="px-6 py-4" th:text="${data.soilMoisture}"></td>
                    <td class="px-6 py-4" th:text="${data.waterLevel}"></td>
                    <td class="px-6 py-4" th:text="${#temporals.format(data.timestamp, 'yyyy-MM-dd HH:mm:ss')}"></td>
                </tr>
                <tr th:if="${sensorDataList.isEmpty()}">
                    <td colspan="7" class="text-center py-8 text-slate-500">기록된 데이터가 없거나, 검색 조건에 맞는 결과가 없습니다.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="mt-6 flex justify-center items-center" th:if="${totalPages > 0}">
            <nav class="flex items-center gap-2">
                <a th:if="${currentPage > 0}" th:href="@{/sensor_history(page=${currentPage - 1}, startDate=${param.startDate}, endDate=${param.endDate}, deviceId=${param.deviceId})}"
                   class="px-3 py-2 text-slate-600 bg-white rounded-md hover:bg-blue-500 hover:text-white border border-slate-200 transition-colors">
                    &laquo; 이전
                </a>
                <th:block th:with="startPage=${T(java.lang.Math).max(0, currentPage - 2)}, endPage=${T(java.lang.Math).min(totalPages - 1, currentPage + 2)}">
                    <th:block th:each="i : ${#numbers.sequence(startPage, endPage)}">
                        <a th:href="@{/sensor_history(page=${i}, startDate=${param.startDate}, endDate=${param.endDate}, deviceId=${param.deviceId})}" th:text="${i + 1}"
                           th:classappend="${i == currentPage} ? 'bg-blue-600 text-white font-bold' : 'bg-white text-slate-600'"
                           class="px-4 py-2 rounded-md hover:bg-blue-500 hover:text-white border border-slate-200 transition-colors">
                        </a>
                    </th:block>
                </th:block>
                <a th:if="${currentPage < totalPages - 1}" th:href="@{/sensor_history(page=${currentPage + 1}, startDate=${param.startDate}, endDate=${param.endDate}, deviceId=${param.deviceId})}"
                   class="px-3 py-2 text-slate-600 bg-white rounded-md hover:bg-blue-500 hover:text-white border border-slate-200 transition-colors">
                    다음 &raquo;
                </a>
            </nav>
        </div>
    </main>
</div>

<div th:replace="~{fragments/sidebar :: sidebarScript}"></div>
</body>
</html>